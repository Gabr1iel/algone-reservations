name: Discord Notification

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          COMMIT_MSG=$(echo '${{ github.event.head_commit.message }}' | head -1)
          AUTHOR="${{ github.event.head_commit.author.name }}"
          REPO="${{ github.repository }}"
          COMMIT_URL="${{ github.event.head_commit.url }}"
          SHORT_SHA=$(echo "${{ github.sha }}" | cut -c1-7)

          curl -H "Content-Type: application/json" \
            -d "{
              \"content\": \"@Škola  Změna v main!\",
              \"embeds\": [{
                \"title\": \"New push to main\",
                \"color\": 5814783,
                \"fields\": [
                  { \"name\": \"Repository\", \"value\": \"${REPO}\", \"inline\": true },
                  { \"name\": \"Author\", \"value\": \"${AUTHOR}\", \"inline\": true },
                  { \"name\": \"Commit\", \"value\": \"[\`${SHORT_SHA}\`](${COMMIT_URL})\", \"inline\": true },
                  { \"name\": \"Message\", \"value\": \"${COMMIT_MSG}\" }
                ]
              }]
            }" \
            "$DISCORD_WEBHOOK"
